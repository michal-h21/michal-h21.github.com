\documentclass[]{article}

\usepackage[fencedDivs=true]{markdown}
\usepackage{tcolorbox}
\usepackage{minted}
\fvset{breaklines=true}
% \setminted{breaklines, breakanywhere, breaksymbolleft=\tiny\ensuremath{\hookrightarrow}}
\usepackage{hyperref}
\usepackage{linebreaker}
\usepackage{responsive}
\usepackage{fontspec}
\setmainfont{Linux Libertine O}

\ExplSyntaxOn

% the idea is to use fenced divs with classes to call custom environments with
% the class as an environment name

% define custom tcolorbox environments for warning and info
\newtcolorbox{warning}{colback=red!5!white, colframe=red!75!black,fonttitle=\bfseries, title={Warning}}
\newtcolorbox{info}{colback=blue!5!white, colframe=blue!75!black,fonttitle=\bfseries, title={Info}}

% this macro will be called with the class name as argument 
% it will start the environment with that name
\def\fenceddivclass#1{
  \begin{#1}
  % we also define \endfence to end the environment
  \def\endfence{\end{#1}}
}

% set up the context for fenced divs
\def\markdownRendererFencedDivAttributeContextBegin{
  \begingroup
  % redefine the macro that will be called with the class name to use our 
  \let\markdownRendererAttributeClassName\fenceddivclass
  % if there is no class name, we just define \endfence to do nothing
  \def\endfence{}
}
% end the context by ending the environment and the group
\def\markdownRendererFencedDivAttributeContextEnd{\endfence\endgroup}

% \markdownSetup{
%   renderers = {
%     fencedDivAttributeContextBegin = {%
%       \begingroup
%       % redefine the macro that will be called with the class name to use our 
%       \let\markdownRendererAttributeClassName\fenceddivclass
%       % if there is no class name, we just define \endfence to do nothing
%       \def\endfence{}
%     },
%     fencedDivAttributeContextEnd = {%
%       \endfence\endgroup
%     },
%   },
% }


\ExplSyntaxOff

\title{Markdown Fenced Divs with Tcolorbox}
\author{Michal Hoftich}

\begin{document}
\maketitle

\section{Introduction}

Recently, I came across a question on \href{https://tex.stackexchange.com/q/752194/2891}{TeX.SX} asking how to create Markdown-style boxes for warnings or informational notes.  
The original poster wanted to use a custom Lua filter for Pandoc, but I decided to explore how the same idea could be implemented directly in \LaTeX{} using the \href{https://ctan.org/pkg/markdown?lang=en}{\texttt{Markdown}} package. This package supports the \texttt{fenced divs} feature, which makes such customization possible.  

The \texttt{fencedDivs} extension allows you to specify a class name right after three colons (for example, \texttt{::: warning}) to trigger a custom block.  
I thought it would be interesting to connect these fenced divs to custom \texttt{Tcolorbox} environments, so that writing a Markdown block like this:

\begin{minted}[fontsize=\small,breaklines,frame=lines]{markdown}
::: warning
Some important message here.
:::
\end{minted}

would produce a nicely formatted box with a warning message in the final PDF, like this:

\begin{warning}
Some important message here.
\end{warning}

Since the original question focused on a Pandoc workflow, I didn’t post my code there, but I thought it might be useful for others who work directly with the \texttt{Markdown} package in \LaTeX{}. So I’m sharing it here.

\section{Code Example}

The \texttt{Markdown} package allows us to write Markdown syntax directly inside a \LaTeX{} document.  
By default, it supports basic Markdown features, but it can also be extended with options that enable more advanced behavior. One such option is \mintinline[breaklines,breakanywhere]{latex}{fencedDivs}, which allows us to define custom blocks with specific classes.

We can enable this feature by loading the package with:

\begin{minted}[fontsize=\small,breaklines,frame=lines]{latex}
\usepackage[fencedDivs=true]{markdown}
\end{minted}

Next, we can define custom environments using the
\href{https://ctan.org/pkg/tcolorbox?lang=en}{Tcolorbox} package. These
environments will provide the styled boxes that correspond to fenced divs in
Markdown:

\begin{minted}[fontsize=\small,breaklines,frame=lines]{latex}
\newtcolorbox{warning}{colback=red!5!white, colframe=red!75!black,fonttitle=\bfseries, title={Warning}}
\newtcolorbox{info}{colback=blue!5!white, colframe=blue!75!black,fonttitle=\bfseries, title={Info}}
\end{minted}

These two commands define the environments \texttt{warning} and \texttt{info}.  
They print their contents inside colored boxes labeled “Warning” and “Info,” respectively:

\begin{minted}[fontsize=\small,breaklines,frame=lines]{latex}
\begin{info}
  This is an info box.
\end{info}
\end{minted}

\begin{info}
  This is an info box.
\end{info}

Now that we have the \texttt{Tcolorbox} environments defined, we can configure the \texttt{Markdown} package to use them whenever it encounters fenced divs with matching class names.  


% For each Markdown feature, the \texttt{Markdown} package defines several macros that can be redefined to customize how the content is rendered.

There are two main ways to redefine the behavior of the \texttt{Markdown} package.  
One approach is to use the \verb|\markdownSetup| command, for example:
\begin{minted}[fontsize=\small,breaklines,frame=lines]{latex}
\markdownSetup{
  renderers = {
    fencedDivAttributeContextBegin = {%
      \par
      \emph{(The beginning of a fenced div attribute context)}
      \par
    },
    fencedDivAttributeContextEnd = {%
      \par
      \emph{(The end of a fenced div attribute context)}
      \par
    },
  },
}
\end{minted}


However, in our case we only want to modify how the \texttt{class} attribute is
processed \emph{inside} a fenced div.  For that reason, it is simpler to
directly redefine the macros that are called at the beginning and at the end of
a fenced div context.  
The challenge is that we also need to know the class name specified in the
fenced div (for example, \texttt{warning} or \texttt{info}).  This class name
is passed to a macro called
\mintinline[breaklines,
breakanywhere]{latex}{\markdownRendererAttributeClassName}, which we can
locally redefine to start the appropriate environment.  To make this work, we
define a custom macro -- in this case, \mintinline[breaklines,
breakanywhere]{latex}{\fenceddivclass} -- that takes the class name as its
argument and begins the corresponding environment (for example,
\mintinline[breaklines,breakanywhere]{latex}{\begin{warning}}).  
Inside this macro, we also define another helper command
\mintinline[breaklines, breakanywhere]{latex}{\endfence}, which stores the
matching \mintinline[breaklines, breakanywhere]{latex}{\end{warning}} (or any
other environment name).  The relevant code looks like this:

\begin{minted}[fontsize=\small,breaklines,frame=lines]{latex}
% this macro will be called with the class name as argument 
% it will start the environment with that name
\def\fenceddivclass#1{
  \begin{#1}
  % we also define \endfence to end the environment
  \def\endfence{\end{#1}}
}

% set up the context for fenced divs
\def\markdownRendererFencedDivAttributeContextBegin{
  \begingroup
  % redefine the macro that will be called with the class name 
  \let\markdownRendererAttributeClassName\fenceddivclass
  % if there is no class name, we just define \endfence to do nothing
  \def\endfence{}
}
% end the context by ending the environment and the group
\def\markdownRendererFencedDivAttributeContextEnd{\endfence\endgroup}
\end{minted}


By redefining \mintinline[breaklines,
breakanywhere]{latex}{\markdownRendererAttributeClassName} to point to
\mintinline[breaklines,breakanywhere]{latex}{\fenceddivclass} inside the fenced
div context, each fenced div with a class name automatically opens and closes
the correct environment when encountered.

\section{Full Source Code}

Here is the complete \LaTeX{} code that demonstrates this approach:

\begin{minted}[fontsize=\small,breaklines,frame=lines]{latex}
\documentclass[draft]{article}

\usepackage[fencedDivs=true]{markdown}
\usepackage{tcolorbox}

\ExplSyntaxOn

% the idea is to use fenced divs with classes to call custom environments with
% the class as an environment name

% define custom tcolorbox environments for warning and info
\newtcolorbox{warning}{colback=red!5!white, colframe=red!75!black,fonttitle=\bfseries, title={Warning}}
\newtcolorbox{info}{colback=blue!5!white, colframe=blue!75!black,fonttitle=\bfseries, title={Info}}

% this macro will be called with the class name as argument 
% it will start the environment with that name
\def\fenceddivclass#1{
  \begin{#1}
  % we also define \endfence to end the environment
  \def\endfence{\end{#1}}
}

% set up the context for fenced divs
\def\markdownRendererFencedDivAttributeContextBegin{
  \begingroup
  % redefine the macro that will be called with the class name 
  \let\markdownRendererAttributeClassName\fenceddivclass
  % if there is no class name, we just define \endfence to do nothing
  \def\endfence{}
}
% end the context by ending the environment and the group
\def\markdownRendererFencedDivAttributeContextEnd{\endfence\endgroup}
\ExplSyntaxOff

\begin{document}

\begin{markdown}

::: warning
hello
:::

::: info
this is an info box
:::

\end{markdown}
\end{document}
\end{minted}

Compiling this document will render the Markdown content with two nicely styled boxes --
a red warning box and a blue info box.  
You can compile the code to PDF using Lua\LaTeX{} to see the result:

\begin{minted}[fontsize=\small,breaklines,frame=lines]{bash}
$ lualatex markdownfenced.tex
\end{minted}

If you want to generate an HTML document instead, you can use \href{https://tug.org/tex4ht/}{\TeX4ht},
as it supports both the \texttt{Tcolorbox} and the \texttt{Markdown} packages.

\begin{minted}[fontsize=\small,breaklines,frame=lines]{bash}
$ make4ht -l markdownfenced.tex
\end{minted}

This will produce a file named \texttt{markdownfenced.html} with the following rendered content:

\begin{markdown}

::: warning
hello
:::

::: info
this is an info box
:::

\end{markdown}

\section{Conclusion}


I hope some of you find this approach useful for integrating Markdown-style
fenced divs with custom \texttt{Tcolorbox} environments in your \LaTeX{}
documents, or at least as an interesting exercise in customizing the
\texttt{Markdown} package to produce specific output.

\end{document}
